{% extends '@!EasyAdmin/layout.html.twig' %}

{% block main %}
    <h3>Agir sur la commande</h3>
    {% if order.state != 1 %}
        <a href="{{current_url}}&state=3">Commande en cours de préparation</a>
        <a href="{{current_url}}&state=4">Commande expediée</a>
        <a href="{{current_url}}&state=5">Commande annulée</a>
    {% else %}
        Vous ne pouvez pas agir sur une commande qui n'est pas encore payée.
    {% endif %}
    
    <hr>
    <small><a href="{{ path('app_invoice_admin', {id_order: order.id}) }}" class="btn btn-light btn-sm ">Voir/Imprimer facture</a></small>
    <h3 class="mt-2">Commande n°{{ order.id }}</h3>

    {{ include('admin/state.html.twig', { field: {'value': order.state}}) }} <br>

    <span class="mt-3">Passée le: {{ order.createdAt | date('d/m/Y') }}</span><br>
    <span>Stripe Session Id: {{ order.stripeSessionId }}</span>


    <div class="row my-4">
        <div class="col-md-6">
            <strong>Adresse de livraison :</strong><br>
            {{ order.delivery | raw }}
        </div>
        <div class="col-md-6">
            <strong>Transporteur :</strong><br>
            {{ order.carrierName }}
        </div>
    </div>

    <strong>Contenu de la commande: </strong>
    

    <table class="table">
                <thead>
                    <tr>
                    <th scope="col">Illustration</th>
                    <th scope="col">Nom du produit</th>
                    <th scope="col">Quantité</th>
                    <th scope="col">Prix unitaire HT</th>
                    <th scope="col">TVA</th>
                    <th scope="col">Prix Total TTC</th>
                    </tr>
                </thead>
                <tbody>
                   
                    {% for product in order.orderDetails %}
                        <tr>
                            <td><img src="uploads/{{ product.productIllustration }}" width="100px" alt=""></td>
                            <td>{{ product.productName }}</td>
                            <td>{{ product.productQuantity }}</td>
                            <td>{{ product.productPrice | price}}</td>
                            <td>{{ product.productTva}}%</td>
                            {% set coeff = 1 + (product.productTva / 100)  %}
                            <td>{{ ((coeff * product.productPrice) * product.productQuantity) | price }}</td>
                            
                        </tr>
                    {% endfor %}
                        <tr>
                            <td></td>
                            <td>Transporteur: {{ order.carrierName }}</td>
                            <td>1</td>
                            <td></td>
                            <td></td>
                            <td>{{ order.carrierPrice | price }}</td>
                        </tr>
                    
                </tbody>
            </table>

            <div class="text-right fs-5">
                <strong>Total H.T. :</strong> {{ (order.totalWt - order.totalTva)| price }} <br>
                <strong>Total TVA :</strong> {{ order.totalTva | price }} <br>
                <strong>Total T.T.C :</strong> {{ order.totalWt | price }} <br>
            </div>

{% endblock %}